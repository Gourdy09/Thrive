{"version":3,"names":["useEffect","useRef","useState","Skia","Platform","factoryWrapper","data2","factory","onError","factoryResult","Error","loadData","source","undefined","Promise","resolve","Uint8Array","Data","fromBytes","uri","resolveAsset","fromURI","then","d","useLoading","loader","manage","mounted","data","setData","dataRef","current","value","_dataRef$current","dispose","useCollectionLoading","result","filter","r","_dataRef$current2","forEach","instance","useRawData","identity","useData"],"sources":["Data.ts"],"sourcesContent":["import { useEffect, useRef, useState } from \"react\";\n\nimport { Skia } from \"../Skia\";\nimport type { SkData, DataSourceParam, SkJSIInstance } from \"../types\";\nimport { Platform } from \"../../Platform\";\n\nconst factoryWrapper = <T>(\n  data2: SkData,\n  factory: (data: SkData) => T,\n  onError?: (err: Error) => void\n) => {\n  const factoryResult = factory(data2);\n  if (factoryResult === null) {\n    onError && onError(new Error(\"Could not load data\"));\n    return null;\n  } else {\n    return factoryResult;\n  }\n};\n\nexport const loadData = <T>(\n  source: DataSourceParam,\n  factory: (data: SkData) => T | null,\n  onError?: (err: Error) => void\n): Promise<T | null> => {\n  if (source === null || source === undefined) {\n    return new Promise((resolve) => resolve(null));\n  } else if (source instanceof Uint8Array) {\n    return new Promise((resolve) =>\n      resolve(factoryWrapper(Skia.Data.fromBytes(source), factory, onError))\n    );\n  } else {\n    const uri =\n      typeof source === \"string\" ? source : Platform.resolveAsset(source);\n    return Skia.Data.fromURI(uri).then((d) =>\n      factoryWrapper(d, factory, onError)\n    );\n  }\n};\n\nconst useLoading = <T extends SkJSIInstance<string>>(\n  source: DataSourceParam,\n  loader: () => Promise<T | null>,\n  manage = true\n) => {\n  const mounted = useRef(false);\n  const [data, setData] = useState<T | null>(null);\n  const dataRef = useRef<T | null>(null);\n  useEffect(() => {\n    mounted.current = true;\n    loader().then((value) => {\n      if (mounted.current) {\n        setData(value);\n        dataRef.current = value;\n      }\n    });\n    return () => {\n      if (manage) {\n        dataRef.current?.dispose();\n      }\n      mounted.current = false;\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [source]);\n  return data;\n};\n\nexport const useCollectionLoading = <T extends SkJSIInstance<string>>(\n  source: DataSourceParam[],\n  loader: () => Promise<(T | null)[]>\n) => {\n  const mounted = useRef(false);\n  const [data, setData] = useState<T[] | null>(null);\n  const dataRef = useRef<T[] | null>(null);\n\n  useEffect(() => {\n    mounted.current = true;\n    loader().then((result) => {\n      const value = result.filter((r) => r !== null) as T[];\n      if (mounted.current) {\n        setData(value);\n        dataRef.current = value;\n      }\n    });\n\n    return () => {\n      dataRef.current?.forEach((instance) => instance?.dispose());\n      mounted.current = false;\n    };\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [source]);\n\n  return data;\n};\n\nexport const useRawData = <T extends SkJSIInstance<string>>(\n  source: DataSourceParam,\n  factory: (data: SkData) => T | null,\n  onError?: (err: Error) => void,\n  manage = true\n) => useLoading(source, () => loadData<T>(source, factory, onError), manage);\n\nconst identity = (data: SkData) => data;\n\nexport const useData = (\n  source: DataSourceParam,\n  onError?: (err: Error) => void\n) => useRawData(source, identity, onError);\n"],"mappings":"AAAA,SAASA,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,OAAO;AAEnD,SAASC,IAAI,QAAQ,SAAS;AAE9B,SAASC,QAAQ,QAAQ,gBAAgB;AAEzC,MAAMC,cAAc,GAAGA,CACrBC,KAAa,EACbC,OAA4B,EAC5BC,OAA8B,KAC3B;EACH,MAAMC,aAAa,GAAGF,OAAO,CAACD,KAAK,CAAC;EACpC,IAAIG,aAAa,KAAK,IAAI,EAAE;IAC1BD,OAAO,IAAIA,OAAO,CAAC,IAAIE,KAAK,CAAC,qBAAqB,CAAC,CAAC;IACpD,OAAO,IAAI;EACb,CAAC,MAAM;IACL,OAAOD,aAAa;EACtB;AACF,CAAC;AAED,OAAO,MAAME,QAAQ,GAAGA,CACtBC,MAAuB,EACvBL,OAAmC,EACnCC,OAA8B,KACR;EACtB,IAAII,MAAM,KAAK,IAAI,IAAIA,MAAM,KAAKC,SAAS,EAAE;IAC3C,OAAO,IAAIC,OAAO,CAAEC,OAAO,IAAKA,OAAO,CAAC,IAAI,CAAC,CAAC;EAChD,CAAC,MAAM,IAAIH,MAAM,YAAYI,UAAU,EAAE;IACvC,OAAO,IAAIF,OAAO,CAAEC,OAAO,IACzBA,OAAO,CAACV,cAAc,CAACF,IAAI,CAACc,IAAI,CAACC,SAAS,CAACN,MAAM,CAAC,EAAEL,OAAO,EAAEC,OAAO,CAAC,CACvE,CAAC;EACH,CAAC,MAAM;IACL,MAAMW,GAAG,GACP,OAAOP,MAAM,KAAK,QAAQ,GAAGA,MAAM,GAAGR,QAAQ,CAACgB,YAAY,CAACR,MAAM,CAAC;IACrE,OAAOT,IAAI,CAACc,IAAI,CAACI,OAAO,CAACF,GAAG,CAAC,CAACG,IAAI,CAAEC,CAAC,IACnClB,cAAc,CAACkB,CAAC,EAAEhB,OAAO,EAAEC,OAAO,CACpC,CAAC;EACH;AACF,CAAC;AAED,MAAMgB,UAAU,GAAGA,CACjBZ,MAAuB,EACvBa,MAA+B,EAC/BC,MAAM,GAAG,IAAI,KACV;EACH,MAAMC,OAAO,GAAG1B,MAAM,CAAC,KAAK,CAAC;EAC7B,MAAM,CAAC2B,IAAI,EAAEC,OAAO,CAAC,GAAG3B,QAAQ,CAAW,IAAI,CAAC;EAChD,MAAM4B,OAAO,GAAG7B,MAAM,CAAW,IAAI,CAAC;EACtCD,SAAS,CAAC,MAAM;IACd2B,OAAO,CAACI,OAAO,GAAG,IAAI;IACtBN,MAAM,CAAC,CAAC,CAACH,IAAI,CAAEU,KAAK,IAAK;MACvB,IAAIL,OAAO,CAACI,OAAO,EAAE;QACnBF,OAAO,CAACG,KAAK,CAAC;QACdF,OAAO,CAACC,OAAO,GAAGC,KAAK;MACzB;IACF,CAAC,CAAC;IACF,OAAO,MAAM;MACX,IAAIN,MAAM,EAAE;QAAA,IAAAO,gBAAA;QACV,CAAAA,gBAAA,GAAAH,OAAO,CAACC,OAAO,cAAAE,gBAAA,eAAfA,gBAAA,CAAiBC,OAAO,CAAC,CAAC;MAC5B;MACAP,OAAO,CAACI,OAAO,GAAG,KAAK;IACzB,CAAC;IACD;EACF,CAAC,EAAE,CAACnB,MAAM,CAAC,CAAC;EACZ,OAAOgB,IAAI;AACb,CAAC;AAED,OAAO,MAAMO,oBAAoB,GAAGA,CAClCvB,MAAyB,EACzBa,MAAmC,KAChC;EACH,MAAME,OAAO,GAAG1B,MAAM,CAAC,KAAK,CAAC;EAC7B,MAAM,CAAC2B,IAAI,EAAEC,OAAO,CAAC,GAAG3B,QAAQ,CAAa,IAAI,CAAC;EAClD,MAAM4B,OAAO,GAAG7B,MAAM,CAAa,IAAI,CAAC;EAExCD,SAAS,CAAC,MAAM;IACd2B,OAAO,CAACI,OAAO,GAAG,IAAI;IACtBN,MAAM,CAAC,CAAC,CAACH,IAAI,CAAEc,MAAM,IAAK;MACxB,MAAMJ,KAAK,GAAGI,MAAM,CAACC,MAAM,CAAEC,CAAC,IAAKA,CAAC,KAAK,IAAI,CAAQ;MACrD,IAAIX,OAAO,CAACI,OAAO,EAAE;QACnBF,OAAO,CAACG,KAAK,CAAC;QACdF,OAAO,CAACC,OAAO,GAAGC,KAAK;MACzB;IACF,CAAC,CAAC;IAEF,OAAO,MAAM;MAAA,IAAAO,iBAAA;MACX,CAAAA,iBAAA,GAAAT,OAAO,CAACC,OAAO,cAAAQ,iBAAA,eAAfA,iBAAA,CAAiBC,OAAO,CAAEC,QAAQ,IAAKA,QAAQ,aAARA,QAAQ,uBAARA,QAAQ,CAAEP,OAAO,CAAC,CAAC,CAAC;MAC3DP,OAAO,CAACI,OAAO,GAAG,KAAK;IACzB,CAAC;;IAED;EACF,CAAC,EAAE,CAACnB,MAAM,CAAC,CAAC;EAEZ,OAAOgB,IAAI;AACb,CAAC;AAED,OAAO,MAAMc,UAAU,GAAGA,CACxB9B,MAAuB,EACvBL,OAAmC,EACnCC,OAA8B,EAC9BkB,MAAM,GAAG,IAAI,KACVF,UAAU,CAACZ,MAAM,EAAE,MAAMD,QAAQ,CAAIC,MAAM,EAAEL,OAAO,EAAEC,OAAO,CAAC,EAAEkB,MAAM,CAAC;AAE5E,MAAMiB,QAAQ,GAAIf,IAAY,IAAKA,IAAI;AAEvC,OAAO,MAAMgB,OAAO,GAAGA,CACrBhC,MAAuB,EACvBJ,OAA8B,KAC3BkC,UAAU,CAAC9B,MAAM,EAAE+B,QAAQ,EAAEnC,OAAO,CAAC"}