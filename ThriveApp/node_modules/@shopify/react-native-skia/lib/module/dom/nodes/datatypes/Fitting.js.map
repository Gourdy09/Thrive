{"version":3,"names":["exhaustiveCheck","size","width","height","rect2rect","src","dst","scaleX","scaleY","translateX","x","translateY","y","fitRects","fit","rect","sizes","applyBoxFit","inscribe","halfWidthDelta","halfHeightDelta","input","output","Math","min","aspectRatio"],"sources":["Fitting.ts"],"sourcesContent":["import { exhaustiveCheck } from \"../../../renderer/typeddash\";\nimport type { SkRect } from \"../../../skia/types\";\nimport type { Fit } from \"../../types\";\n\nexport interface Size {\n  width: number;\n  height: number;\n}\n\nexport const size = (width = 0, height = 0) => ({ width, height });\n\nexport const rect2rect = (\n  src: SkRect,\n  dst: SkRect\n): [\n  { translateX: number },\n  { translateY: number },\n  { scaleX: number },\n  { scaleY: number }\n] => {\n  const scaleX = dst.width / src.width;\n  const scaleY = dst.height / src.height;\n  const translateX = dst.x - src.x * scaleX;\n  const translateY = dst.y - src.y * scaleY;\n  return [{ translateX }, { translateY }, { scaleX }, { scaleY }];\n};\n\nexport const fitRects = (\n  fit: Fit,\n  rect: SkRect,\n  { x, y, width, height }: SkRect\n) => {\n  const sizes = applyBoxFit(\n    fit,\n    { width: rect.width, height: rect.height },\n    { width, height }\n  );\n  const src = inscribe(sizes.src, rect);\n  const dst = inscribe(sizes.dst, {\n    x,\n    y,\n    width,\n    height,\n  });\n  return { src, dst };\n};\n\nconst inscribe = (\n  { width, height }: Size,\n  rect: { x: number; y: number; width: number; height: number }\n) => {\n  const halfWidthDelta = (rect.width - width) / 2.0;\n  const halfHeightDelta = (rect.height - height) / 2.0;\n  return {\n    x: rect.x + halfWidthDelta,\n    y: rect.y + halfHeightDelta,\n    width,\n    height,\n  };\n};\n\nconst applyBoxFit = (fit: Fit, input: Size, output: Size) => {\n  let src = size(),\n    dst = size();\n  if (\n    input.height <= 0.0 ||\n    input.width <= 0.0 ||\n    output.height <= 0.0 ||\n    output.width <= 0.0\n  ) {\n    return { src, dst };\n  }\n  switch (fit) {\n    case \"fill\":\n      src = input;\n      dst = output;\n      break;\n    case \"contain\":\n      src = input;\n      if (output.width / output.height > src.width / src.height) {\n        dst = size((src.width * output.height) / src.height, output.height);\n      } else {\n        dst = size(output.width, (src.height * output.width) / src.width);\n      }\n      break;\n    case \"cover\":\n      if (output.width / output.height > input.width / input.height) {\n        src = size(input.width, (input.width * output.height) / output.width);\n      } else {\n        src = size((input.height * output.width) / output.height, input.height);\n      }\n      dst = output;\n      break;\n    case \"fitWidth\":\n      src = size(input.width, (input.width * output.height) / output.width);\n      dst = size(output.width, (src.height * output.width) / src.width);\n      break;\n    case \"fitHeight\":\n      src = size((input.height * output.width) / output.height, input.height);\n      dst = size((src.width * output.height) / src.height, output.height);\n      break;\n    case \"none\":\n      src = size(\n        Math.min(input.width, output.width),\n        Math.min(input.height, output.height)\n      );\n      dst = src;\n      break;\n    case \"scaleDown\":\n      src = input;\n      dst = input;\n      const aspectRatio = input.width / input.height;\n      if (dst.height > output.height) {\n        dst = size(output.height * aspectRatio, output.height);\n      }\n      if (dst.width > output.width) {\n        dst = size(output.width, output.width / aspectRatio);\n      }\n      break;\n    default:\n      exhaustiveCheck(fit);\n  }\n  return { src, dst };\n};\n"],"mappings":"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"}