{"version":3,"names":["processUniforms","FilterMode","MipmapMode","TileMode","JsiDeclarationNode","DeclarationType","NodeType","enumKey","fitRects","getRect","processGradientProps","processTransformProps","rect2rect","ShaderDeclaration","constructor","ctx","type","props","Shader","ShaderNode","decorate","decorateChildren","source","uniforms","transform","m3","Skia","Matrix","shader","makeShaderWithChildren","shaders","popAll","push","ImageShaderNode","ImageShader","fit","image","tx","ty","fm","mm","imageShaderProps","rct","rects","x","y","width","height","sx","sy","src","dst","translate","translateX","translateY","scale","scaleX","scaleY","lm","concat","makeShaderOptions","ColorNode","ColorShader","color","MakeColor","Color","TurbulenceNode","Turbulence","freqX","freqY","octaves","seed","tileWidth","tileHeight","MakeTurbulence","FractalNoiseNode","FractalNoise","MakeFractalNoise","LinearGradientNode","LinearGradient","start","end","colors","positions","mode","localMatrix","flags","MakeLinearGradient","RadialGradientNode","RadialGradient","c","r","MakeRadialGradient","SweepGradientNode","SweepGradient","MakeSweepGradient","TwoPointConicalGradientNode","TwoPointConicalGradient","startR","endR","MakeTwoPointConicalGradient"],"sources":["Shaders.ts"],"sourcesContent":["import {\n  processUniforms,\n  FilterMode,\n  MipmapMode,\n  TileMode,\n} from \"../../../skia/types\";\nimport type { NodeContext } from \"../Node\";\nimport { JsiDeclarationNode } from \"../Node\";\nimport type {\n  ColorProps,\n  DeclarationContext,\n  FractalNoiseProps,\n  ImageShaderProps,\n  LinearGradientProps,\n  RadialGradientProps,\n  ShaderProps,\n  SweepGradientProps,\n  TurbulenceProps,\n  TwoPointConicalGradientProps,\n} from \"../../types\";\nimport { DeclarationType, NodeType } from \"../../types\";\nimport {\n  enumKey,\n  fitRects,\n  getRect,\n  processGradientProps,\n  processTransformProps,\n  rect2rect,\n} from \"../datatypes\";\n\nexport abstract class ShaderDeclaration<P> extends JsiDeclarationNode<P> {\n  constructor(ctx: NodeContext, type: NodeType, props: P) {\n    super(ctx, DeclarationType.Shader, type, props);\n  }\n}\n\nexport class ShaderNode extends ShaderDeclaration<ShaderProps> {\n  constructor(ctx: NodeContext, props: ShaderProps) {\n    super(ctx, NodeType.Shader, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    this.decorateChildren(ctx);\n    const { source, uniforms, ...transform } = this.props;\n    const m3 = this.Skia.Matrix();\n    processTransformProps(m3, transform);\n    const shader = source.makeShaderWithChildren(\n      processUniforms(source, uniforms),\n      ctx.shaders.popAll(),\n      m3\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class ImageShaderNode extends ShaderDeclaration<ImageShaderProps> {\n  constructor(ctx: NodeContext, props: ImageShaderProps) {\n    super(ctx, NodeType.ImageShader, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { fit, image, tx, ty, fm, mm, ...imageShaderProps } = this.props;\n    if (!image) {\n      return;\n    }\n\n    const rct = getRect(this.Skia, imageShaderProps);\n    const m3 = this.Skia.Matrix();\n    if (rct) {\n      const rects = fitRects(\n        fit,\n        { x: 0, y: 0, width: image.width(), height: image.height() },\n        rct\n      );\n      const [x, y, sx, sy] = rect2rect(rects.src, rects.dst);\n      m3.translate(x.translateX, y.translateY);\n      m3.scale(sx.scaleX, sy.scaleY);\n    }\n    const lm = this.Skia.Matrix();\n    lm.concat(m3);\n    processTransformProps(lm, imageShaderProps);\n    const shader = image.makeShaderOptions(\n      TileMode[enumKey(tx)],\n      TileMode[enumKey(ty)],\n      FilterMode[enumKey(fm)],\n      MipmapMode[enumKey(mm)],\n      lm\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class ColorNode extends ShaderDeclaration<ColorProps> {\n  constructor(ctx: NodeContext, props: ColorProps) {\n    super(ctx, NodeType.ColorShader, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { color } = this.props;\n    const shader = this.Skia.Shader.MakeColor(this.Skia.Color(color));\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class TurbulenceNode extends ShaderDeclaration<TurbulenceProps> {\n  constructor(ctx: NodeContext, props: TurbulenceProps) {\n    super(ctx, NodeType.Turbulence, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { freqX, freqY, octaves, seed, tileWidth, tileHeight } = this.props;\n    const shader = this.Skia.Shader.MakeTurbulence(\n      freqX,\n      freqY,\n      octaves,\n      seed,\n      tileWidth,\n      tileHeight\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class FractalNoiseNode extends ShaderDeclaration<FractalNoiseProps> {\n  constructor(ctx: NodeContext, props: FractalNoiseProps) {\n    super(ctx, NodeType.FractalNoise, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { freqX, freqY, octaves, seed, tileWidth, tileHeight } = this.props;\n    const shader = this.Skia.Shader.MakeFractalNoise(\n      freqX,\n      freqY,\n      octaves,\n      seed,\n      tileWidth,\n      tileHeight\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class LinearGradientNode extends ShaderDeclaration<LinearGradientProps> {\n  constructor(ctx: NodeContext, props: LinearGradientProps) {\n    super(ctx, NodeType.LinearGradient, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { start, end } = this.props;\n    const { colors, positions, mode, localMatrix, flags } =\n      processGradientProps(this.Skia, this.props);\n    const shader = this.Skia.Shader.MakeLinearGradient(\n      start,\n      end,\n      colors,\n      positions ?? null,\n      mode,\n      localMatrix,\n      flags\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class RadialGradientNode extends ShaderDeclaration<RadialGradientProps> {\n  constructor(ctx: NodeContext, props: RadialGradientProps) {\n    super(ctx, NodeType.RadialGradient, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { c, r } = this.props;\n    const { colors, positions, mode, localMatrix, flags } =\n      processGradientProps(this.Skia, this.props);\n    const shader = this.Skia.Shader.MakeRadialGradient(\n      c,\n      r,\n      colors,\n      positions,\n      mode,\n      localMatrix,\n      flags\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class SweepGradientNode extends ShaderDeclaration<SweepGradientProps> {\n  constructor(ctx: NodeContext, props: SweepGradientProps) {\n    super(ctx, NodeType.SweepGradient, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { c, start, end } = this.props;\n    const { colors, positions, mode, localMatrix, flags } =\n      processGradientProps(this.Skia, this.props);\n    const shader = this.Skia.Shader.MakeSweepGradient(\n      c.x,\n      c.y,\n      colors,\n      positions,\n      mode,\n      localMatrix,\n      flags,\n      start,\n      end\n    );\n    ctx.shaders.push(shader);\n  }\n}\n\nexport class TwoPointConicalGradientNode extends ShaderDeclaration<TwoPointConicalGradientProps> {\n  constructor(ctx: NodeContext, props: TwoPointConicalGradientProps) {\n    super(ctx, NodeType.TwoPointConicalGradient, props);\n  }\n\n  decorate(ctx: DeclarationContext) {\n    const { startR, endR, start, end } = this.props;\n    const { colors, positions, mode, localMatrix, flags } =\n      processGradientProps(this.Skia, this.props);\n    const shader = this.Skia.Shader.MakeTwoPointConicalGradient(\n      start,\n      startR,\n      end,\n      endR,\n      colors,\n      positions,\n      mode,\n      localMatrix,\n      flags\n    );\n    ctx.shaders.push(shader);\n  }\n}\n"],"mappings":"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"}