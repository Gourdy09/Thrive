{"version":3,"names":["JsiDeclarationNode","PaintNode","JsiRenderNode","JsiDrawingNode","constructor","ctx","type","props","_defineProperty","derived","deriveProps","setProps","setProp","name","value","hasChanged","addChild","child","Error","insertChildBefore","before","renderNode","paint","draw","children","map","declCtx","declarationCtx","save","decorate","paints","pop","restore"],"sources":["DrawingNode.ts"],"sourcesContent":["import type {\n  DrawingContext,\n  DrawingNodeProps,\n  Node,\n  NodeType,\n  RenderNode,\n} from \"../types\";\n\nimport type { NodeContext } from \"./Node\";\nimport { JsiDeclarationNode } from \"./Node\";\nimport { PaintNode } from \"./PaintNode\";\nimport { JsiRenderNode } from \"./RenderNode\";\n\nexport abstract class JsiDrawingNode<P extends DrawingNodeProps, C>\n  extends JsiRenderNode<P>\n  implements RenderNode<P>\n{\n  protected derived?: C;\n\n  constructor(ctx: NodeContext, type: NodeType, props: P) {\n    super(ctx, type, props);\n    this.derived = this.deriveProps();\n  }\n\n  setProps(props: P) {\n    super.setProps(props);\n    this.derived = this.deriveProps();\n  }\n\n  setProp<K extends keyof P>(name: K, value: P[K]) {\n    const hasChanged = super.setProp(name, value);\n    if (hasChanged) {\n      this.derived = this.deriveProps();\n    }\n    return hasChanged;\n  }\n\n  addChild(child: Node<unknown>): void {\n    if (!(child instanceof JsiDeclarationNode)) {\n      throw new Error(`Cannot add ${child.type} to ${this.type}`);\n    }\n    super.addChild(child);\n    this.derived = this.deriveProps();\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>): void {\n    if (!(child instanceof JsiDeclarationNode)) {\n      throw new Error(`Cannot add ${child.type} to ${this.type}`);\n    }\n    super.insertChildBefore(child, before);\n    this.derived = this.deriveProps();\n  }\n\n  renderNode(ctx: DrawingContext): void {\n    if (this.props.paint) {\n      this.draw({ ...ctx, paint: this.props.paint });\n    } else {\n      this.draw(ctx);\n    }\n    this.children().map((child) => {\n      if (child instanceof PaintNode) {\n        const declCtx = ctx.declarationCtx;\n        declCtx.save();\n        child.decorate(declCtx);\n        const paint = declCtx.paints.pop()!;\n        declCtx.restore();\n        this.draw({ ...ctx, paint });\n      }\n    });\n  }\n\n  protected abstract draw(ctx: DrawingContext): void;\n  protected abstract deriveProps(): C;\n}\n"],"mappings":";;;AASA,SAASA,kBAAkB,QAAQ,QAAQ;AAC3C,SAASC,SAAS,QAAQ,aAAa;AACvC,SAASC,aAAa,QAAQ,cAAc;AAE5C,OAAO,MAAeC,cAAc,SAC1BD,aAAa,CAEvB;EAGEE,WAAWA,CAACC,GAAgB,EAAEC,IAAc,EAAEC,KAAQ,EAAE;IACtD,KAAK,CAACF,GAAG,EAAEC,IAAI,EAAEC,KAAK,CAAC;IAACC,eAAA;IACxB,IAAI,CAACC,OAAO,GAAG,IAAI,CAACC,WAAW,CAAC,CAAC;EACnC;EAEAC,QAAQA,CAACJ,KAAQ,EAAE;IACjB,KAAK,CAACI,QAAQ,CAACJ,KAAK,CAAC;IACrB,IAAI,CAACE,OAAO,GAAG,IAAI,CAACC,WAAW,CAAC,CAAC;EACnC;EAEAE,OAAOA,CAAoBC,IAAO,EAAEC,KAAW,EAAE;IAC/C,MAAMC,UAAU,GAAG,KAAK,CAACH,OAAO,CAACC,IAAI,EAAEC,KAAK,CAAC;IAC7C,IAAIC,UAAU,EAAE;MACd,IAAI,CAACN,OAAO,GAAG,IAAI,CAACC,WAAW,CAAC,CAAC;IACnC;IACA,OAAOK,UAAU;EACnB;EAEAC,QAAQA,CAACC,KAAoB,EAAQ;IACnC,IAAI,EAAEA,KAAK,YAAYjB,kBAAkB,CAAC,EAAE;MAC1C,MAAM,IAAIkB,KAAK,CAAE,cAAaD,KAAK,CAACX,IAAK,OAAM,IAAI,CAACA,IAAK,EAAC,CAAC;IAC7D;IACA,KAAK,CAACU,QAAQ,CAACC,KAAK,CAAC;IACrB,IAAI,CAACR,OAAO,GAAG,IAAI,CAACC,WAAW,CAAC,CAAC;EACnC;EAEAS,iBAAiBA,CAACF,KAAoB,EAAEG,MAAqB,EAAQ;IACnE,IAAI,EAAEH,KAAK,YAAYjB,kBAAkB,CAAC,EAAE;MAC1C,MAAM,IAAIkB,KAAK,CAAE,cAAaD,KAAK,CAACX,IAAK,OAAM,IAAI,CAACA,IAAK,EAAC,CAAC;IAC7D;IACA,KAAK,CAACa,iBAAiB,CAACF,KAAK,EAAEG,MAAM,CAAC;IACtC,IAAI,CAACX,OAAO,GAAG,IAAI,CAACC,WAAW,CAAC,CAAC;EACnC;EAEAW,UAAUA,CAAChB,GAAmB,EAAQ;IACpC,IAAI,IAAI,CAACE,KAAK,CAACe,KAAK,EAAE;MACpB,IAAI,CAACC,IAAI,CAAC;QAAE,GAAGlB,GAAG;QAAEiB,KAAK,EAAE,IAAI,CAACf,KAAK,CAACe;MAAM,CAAC,CAAC;IAChD,CAAC,MAAM;MACL,IAAI,CAACC,IAAI,CAAClB,GAAG,CAAC;IAChB;IACA,IAAI,CAACmB,QAAQ,CAAC,CAAC,CAACC,GAAG,CAAER,KAAK,IAAK;MAC7B,IAAIA,KAAK,YAAYhB,SAAS,EAAE;QAC9B,MAAMyB,OAAO,GAAGrB,GAAG,CAACsB,cAAc;QAClCD,OAAO,CAACE,IAAI,CAAC,CAAC;QACdX,KAAK,CAACY,QAAQ,CAACH,OAAO,CAAC;QACvB,MAAMJ,KAAK,GAAGI,OAAO,CAACI,MAAM,CAACC,GAAG,CAAC,CAAE;QACnCL,OAAO,CAACM,OAAO,CAAC,CAAC;QACjB,IAAI,CAACT,IAAI,CAAC;UAAE,GAAGlB,GAAG;UAAEiB;QAAM,CAAC,CAAC;MAC9B;IACF,CAAC,CAAC;EACJ;AAIF"}