{"version":3,"names":["composeDeclarations","filters","composer","length","reverse","reduce","inner","outer","Declaration","constructor","_defineProperty","index","indexes","save","push","decls","restore","pop","decl","popAll","splice","popAllAsOne","Error","DeclarationContext","Skia","peComp","PathEffect","MakeCompose","bind","ifComp","ImageFilter","cfComp","ColorFilter","paints","maskFilters","shaders","pathEffects","imageFilters","colorFilters"],"sources":["DeclarationContext.ts"],"sourcesContent":["import type {\n  SkShader,\n  SkPaint,\n  SkImageFilter,\n  SkMaskFilter,\n  SkPathEffect,\n  Skia,\n  SkColorFilter,\n} from \"../../skia/types\";\n\ntype Composer<T> = (outer: T, inner: T) => T;\n\nexport const composeDeclarations = <T>(filters: T[], composer: Composer<T>) => {\n  if (filters.length <= 1) {\n    return filters[0];\n  }\n  return filters.reverse().reduce((inner, outer) => {\n    if (!inner) {\n      return outer;\n    }\n    return composer(outer, inner);\n  });\n};\n\nclass Declaration<T> {\n  private decls: T[] = [];\n  private indexes = [0];\n\n  constructor(private composer?: Composer<T>) {}\n\n  private get index() {\n    return this.indexes[this.indexes.length - 1];\n  }\n\n  save() {\n    this.indexes.push(this.decls.length);\n  }\n\n  restore() {\n    this.indexes.pop();\n  }\n\n  pop() {\n    return this.decls.pop();\n  }\n\n  push(decl: T) {\n    this.decls.push(decl);\n  }\n\n  popAll() {\n    return this.decls.splice(this.index, this.decls.length - this.index);\n  }\n\n  popAllAsOne() {\n    if (!this.composer) {\n      throw new Error(\"No composer for this type of declaration\");\n    }\n    const decls = this.popAll();\n    return composeDeclarations(decls, this.composer!);\n  }\n}\n\nexport class DeclarationContext {\n  readonly paints: Declaration<SkPaint>;\n  readonly maskFilters: Declaration<SkMaskFilter>;\n  readonly shaders: Declaration<SkShader>;\n  readonly pathEffects: Declaration<SkPathEffect>;\n  readonly imageFilters: Declaration<SkImageFilter>;\n  readonly colorFilters: Declaration<SkColorFilter>;\n\n  constructor(private Skia: Skia) {\n    const peComp = this.Skia.PathEffect.MakeCompose.bind(this.Skia.PathEffect);\n    const ifComp = this.Skia.ImageFilter.MakeCompose.bind(\n      this.Skia.ImageFilter\n    );\n    const cfComp = this.Skia.ColorFilter.MakeCompose.bind(\n      this.Skia.ColorFilter\n    );\n    this.paints = new Declaration<SkPaint>();\n    this.maskFilters = new Declaration<SkMaskFilter>();\n    this.shaders = new Declaration<SkShader>();\n    this.pathEffects = new Declaration<SkPathEffect>(peComp);\n    this.imageFilters = new Declaration<SkImageFilter>(ifComp);\n    this.colorFilters = new Declaration<SkColorFilter>(cfComp);\n  }\n\n  save() {\n    this.paints.save();\n    this.maskFilters.save();\n    this.shaders.save();\n    this.pathEffects.save();\n    this.imageFilters.save();\n    this.colorFilters.save();\n  }\n\n  restore() {\n    this.paints.restore();\n    this.maskFilters.restore();\n    this.shaders.restore();\n    this.pathEffects.restore();\n    this.imageFilters.restore();\n    this.colorFilters.restore();\n  }\n}\n"],"mappings":"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"}