{"version":3,"names":["JsiNode","constructor","ctx","type","props","_defineProperty","Skia","setProps","setProp","name","v","hasChanged","getProps","children","_children","addChild","child","removeChild","push","dispose","forEach","index","indexOf","node","splice","insertChildBefore","before","beforeIndex","exports","JsiDeclarationNode","declarationType","decorateChildren","decorate","Error","invalidate","setInvalidate"],"sources":["Node.ts"],"sourcesContent":["import type { Skia } from \"../../skia/types\";\nimport type {\n  Node,\n  DeclarationNode,\n  NodeType,\n  DeclarationType,\n} from \"../types\";\nimport type { DeclarationContext } from \"../types/DeclarationContext\";\n\nexport interface NodeContext {\n  Skia: Skia;\n}\n\nexport abstract class JsiNode<P> implements Node<P> {\n  protected _children: JsiNode<unknown>[] = [];\n  protected Skia: Skia;\n\n  constructor(ctx: NodeContext, public type: NodeType, protected props: P) {\n    this.Skia = ctx.Skia;\n  }\n\n  setProps(props: P) {\n    this.props = props;\n  }\n\n  setProp<K extends keyof P>(name: K, v: P[K]) {\n    const hasChanged = this.props[name] !== v;\n    this.props[name] = v;\n    return hasChanged;\n  }\n\n  getProps() {\n    return this.props;\n  }\n\n  children() {\n    return this._children;\n  }\n\n  addChild(child: Node<unknown>) {\n    this.removeChild(child);\n    this._children.push(child as JsiNode<unknown>);\n  }\n\n  dispose() {\n    this._children.forEach((child) => child.dispose());\n  }\n\n  removeChild(child: Node<unknown>) {\n    const index = this._children.indexOf(child as JsiNode<unknown>);\n    if (index !== -1) {\n      const [node] = this._children.splice(index, 1);\n      node.dispose();\n    }\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>) {\n    const index = this._children.indexOf(child as JsiNode<unknown>);\n    if (index !== -1) {\n      this._children.splice(index, 1);\n    }\n    const beforeIndex = this._children.indexOf(before as JsiNode<unknown>);\n    this._children.splice(beforeIndex, 0, child as JsiNode<unknown>);\n  }\n}\n\nexport type Invalidate = () => void;\n\nexport abstract class JsiDeclarationNode<P>\n  extends JsiNode<P>\n  implements DeclarationNode<P>\n{\n  private invalidate: Invalidate = () => {};\n\n  constructor(\n    ctx: NodeContext,\n    public declarationType: DeclarationType,\n    type: NodeType,\n    props: P\n  ) {\n    super(ctx, type, props);\n  }\n\n  abstract decorate(ctx: DeclarationContext): void;\n\n  protected decorateChildren(ctx: DeclarationContext) {\n    this.children().forEach((child) => {\n      if (child instanceof JsiDeclarationNode) {\n        child.decorate(ctx);\n      }\n    });\n  }\n\n  addChild(child: Node<unknown>): void {\n    if (!(child instanceof JsiDeclarationNode)) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    super.addChild(child);\n    this.invalidate();\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>): void {\n    if (!(child instanceof JsiDeclarationNode)) {\n      throw new Error(`Cannot add child of type ${child.type} to ${this.type}`);\n    }\n    super.insertChildBefore(child, before);\n    this.invalidate();\n  }\n\n  dispose() {\n    this.invalidate();\n    super.dispose();\n  }\n\n  setInvalidate(invalidate: Invalidate) {\n    this.invalidate = invalidate;\n  }\n\n  setProps(props: P) {\n    super.setProps(props);\n    this.invalidate();\n  }\n\n  setProp<K extends keyof P>(name: K, v: P[K]) {\n    const hasChanged = super.setProp(name, v);\n    if (hasChanged) {\n      this.invalidate();\n    }\n    return hasChanged;\n  }\n}\n"],"mappings":"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"}