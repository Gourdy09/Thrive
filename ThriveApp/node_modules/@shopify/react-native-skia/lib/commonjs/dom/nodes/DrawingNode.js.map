{"version":3,"names":["_Node","require","_PaintNode","_RenderNode","_defineProperty","obj","key","value","_toPropertyKey","Object","defineProperty","enumerable","configurable","writable","t","i","_toPrimitive","String","r","e","Symbol","toPrimitive","call","TypeError","Number","JsiDrawingNode","JsiRenderNode","constructor","ctx","type","props","derived","deriveProps","setProps","setProp","name","hasChanged","addChild","child","JsiDeclarationNode","Error","insertChildBefore","before","renderNode","paint","draw","children","map","PaintNode","declCtx","declarationCtx","save","decorate","paints","pop","restore","exports"],"sources":["DrawingNode.ts"],"sourcesContent":["import type {\n  DrawingContext,\n  DrawingNodeProps,\n  Node,\n  NodeType,\n  RenderNode,\n} from \"../types\";\n\nimport type { NodeContext } from \"./Node\";\nimport { JsiDeclarationNode } from \"./Node\";\nimport { PaintNode } from \"./PaintNode\";\nimport { JsiRenderNode } from \"./RenderNode\";\n\nexport abstract class JsiDrawingNode<P extends DrawingNodeProps, C>\n  extends JsiRenderNode<P>\n  implements RenderNode<P>\n{\n  protected derived?: C;\n\n  constructor(ctx: NodeContext, type: NodeType, props: P) {\n    super(ctx, type, props);\n    this.derived = this.deriveProps();\n  }\n\n  setProps(props: P) {\n    super.setProps(props);\n    this.derived = this.deriveProps();\n  }\n\n  setProp<K extends keyof P>(name: K, value: P[K]) {\n    const hasChanged = super.setProp(name, value);\n    if (hasChanged) {\n      this.derived = this.deriveProps();\n    }\n    return hasChanged;\n  }\n\n  addChild(child: Node<unknown>): void {\n    if (!(child instanceof JsiDeclarationNode)) {\n      throw new Error(`Cannot add ${child.type} to ${this.type}`);\n    }\n    super.addChild(child);\n    this.derived = this.deriveProps();\n  }\n\n  insertChildBefore(child: Node<unknown>, before: Node<unknown>): void {\n    if (!(child instanceof JsiDeclarationNode)) {\n      throw new Error(`Cannot add ${child.type} to ${this.type}`);\n    }\n    super.insertChildBefore(child, before);\n    this.derived = this.deriveProps();\n  }\n\n  renderNode(ctx: DrawingContext): void {\n    if (this.props.paint) {\n      this.draw({ ...ctx, paint: this.props.paint });\n    } else {\n      this.draw(ctx);\n    }\n    this.children().map((child) => {\n      if (child instanceof PaintNode) {\n        const declCtx = ctx.declarationCtx;\n        declCtx.save();\n        child.decorate(declCtx);\n        const paint = declCtx.paints.pop()!;\n        declCtx.restore();\n        this.draw({ ...ctx, paint });\n      }\n    });\n  }\n\n  protected abstract draw(ctx: DrawingContext): void;\n  protected abstract deriveProps(): C;\n}\n"],"mappings":";;;;;;AASA,IAAAA,KAAA,GAAAC,OAAA;AACA,IAAAC,UAAA,GAAAD,OAAA;AACA,IAAAE,WAAA,GAAAF,OAAA;AAA6C,SAAAG,gBAAAC,GAAA,EAAAC,GAAA,EAAAC,KAAA,IAAAD,GAAA,GAAAE,cAAA,CAAAF,GAAA,OAAAA,GAAA,IAAAD,GAAA,IAAAI,MAAA,CAAAC,cAAA,CAAAL,GAAA,EAAAC,GAAA,IAAAC,KAAA,EAAAA,KAAA,EAAAI,UAAA,QAAAC,YAAA,QAAAC,QAAA,oBAAAR,GAAA,CAAAC,GAAA,IAAAC,KAAA,WAAAF,GAAA;AAAA,SAAAG,eAAAM,CAAA,QAAAC,CAAA,GAAAC,YAAA,CAAAF,CAAA,uCAAAC,CAAA,GAAAA,CAAA,GAAAE,MAAA,CAAAF,CAAA;AAAA,SAAAC,aAAAF,CAAA,EAAAI,CAAA,2BAAAJ,CAAA,KAAAA,CAAA,SAAAA,CAAA,MAAAK,CAAA,GAAAL,CAAA,CAAAM,MAAA,CAAAC,WAAA,kBAAAF,CAAA,QAAAJ,CAAA,GAAAI,CAAA,CAAAG,IAAA,CAAAR,CAAA,EAAAI,CAAA,uCAAAH,CAAA,SAAAA,CAAA,YAAAQ,SAAA,yEAAAL,CAAA,GAAAD,MAAA,GAAAO,MAAA,EAAAV,CAAA;AAEtC,MAAeW,cAAc,SAC1BC,yBAAa,CAEvB;EAGEC,WAAWA,CAACC,GAAgB,EAAEC,IAAc,EAAEC,KAAQ,EAAE;IACtD,KAAK,CAACF,GAAG,EAAEC,IAAI,EAAEC,KAAK,CAAC;IAAC1B,eAAA;IACxB,IAAI,CAAC2B,OAAO,GAAG,IAAI,CAACC,WAAW,CAAC,CAAC;EACnC;EAEAC,QAAQA,CAACH,KAAQ,EAAE;IACjB,KAAK,CAACG,QAAQ,CAACH,KAAK,CAAC;IACrB,IAAI,CAACC,OAAO,GAAG,IAAI,CAACC,WAAW,CAAC,CAAC;EACnC;EAEAE,OAAOA,CAAoBC,IAAO,EAAE5B,KAAW,EAAE;IAC/C,MAAM6B,UAAU,GAAG,KAAK,CAACF,OAAO,CAACC,IAAI,EAAE5B,KAAK,CAAC;IAC7C,IAAI6B,UAAU,EAAE;MACd,IAAI,CAACL,OAAO,GAAG,IAAI,CAACC,WAAW,CAAC,CAAC;IACnC;IACA,OAAOI,UAAU;EACnB;EAEAC,QAAQA,CAACC,KAAoB,EAAQ;IACnC,IAAI,EAAEA,KAAK,YAAYC,wBAAkB,CAAC,EAAE;MAC1C,MAAM,IAAIC,KAAK,CAAE,cAAaF,KAAK,CAACT,IAAK,OAAM,IAAI,CAACA,IAAK,EAAC,CAAC;IAC7D;IACA,KAAK,CAACQ,QAAQ,CAACC,KAAK,CAAC;IACrB,IAAI,CAACP,OAAO,GAAG,IAAI,CAACC,WAAW,CAAC,CAAC;EACnC;EAEAS,iBAAiBA,CAACH,KAAoB,EAAEI,MAAqB,EAAQ;IACnE,IAAI,EAAEJ,KAAK,YAAYC,wBAAkB,CAAC,EAAE;MAC1C,MAAM,IAAIC,KAAK,CAAE,cAAaF,KAAK,CAACT,IAAK,OAAM,IAAI,CAACA,IAAK,EAAC,CAAC;IAC7D;IACA,KAAK,CAACY,iBAAiB,CAACH,KAAK,EAAEI,MAAM,CAAC;IACtC,IAAI,CAACX,OAAO,GAAG,IAAI,CAACC,WAAW,CAAC,CAAC;EACnC;EAEAW,UAAUA,CAACf,GAAmB,EAAQ;IACpC,IAAI,IAAI,CAACE,KAAK,CAACc,KAAK,EAAE;MACpB,IAAI,CAACC,IAAI,CAAC;QAAE,GAAGjB,GAAG;QAAEgB,KAAK,EAAE,IAAI,CAACd,KAAK,CAACc;MAAM,CAAC,CAAC;IAChD,CAAC,MAAM;MACL,IAAI,CAACC,IAAI,CAACjB,GAAG,CAAC;IAChB;IACA,IAAI,CAACkB,QAAQ,CAAC,CAAC,CAACC,GAAG,CAAET,KAAK,IAAK;MAC7B,IAAIA,KAAK,YAAYU,oBAAS,EAAE;QAC9B,MAAMC,OAAO,GAAGrB,GAAG,CAACsB,cAAc;QAClCD,OAAO,CAACE,IAAI,CAAC,CAAC;QACdb,KAAK,CAACc,QAAQ,CAACH,OAAO,CAAC;QACvB,MAAML,KAAK,GAAGK,OAAO,CAACI,MAAM,CAACC,GAAG,CAAC,CAAE;QACnCL,OAAO,CAACM,OAAO,CAAC,CAAC;QACjB,IAAI,CAACV,IAAI,CAAC;UAAE,GAAGjB,GAAG;UAAEgB;QAAM,CAAC,CAAC;MAC9B;IACF,CAAC,CAAC;EACJ;AAIF;AAACY,OAAA,CAAA/B,cAAA,GAAAA,cAAA"}